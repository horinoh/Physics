# 衝突

## ミンコフスキー和 (Minkowski Sum)

- 2 凸包 A, B のミンコフスキー差が原点を含むような場合、　2 凸包は衝突する

## 符号付き体積 (Signed Volume)

### 1 シンプレクス : 線分
- 線分を X, Y, Z軸へ射影する
- 長さが最大になる軸を選択する
- (任意の)点を、選択した軸へ射影する
- シンプレクス上での点の重心パラメータが求められる

### 2 シンプレクス : 三角形
- 三角形を XY, YZ, ZX平面へ射影する
- 面積が最大になる平面を選択する
- (任意の)点を、選択した平面へ射影する
- シンプレクス上での点の重心パラメータが求められる
- 点が、三角形の外部の場合は、点を三角形の辺へ射影し、1 シンプレクスへ帰着

### 3 シンプレクス : 四面体
- (任意の)点が、四面体内部にある場合は重心パラメータを求める
- そうでない場合は、点を各面へ射影し、 2 シンプレクスへ帰着 (最近接面)

### GJK (Gilbert Johnson Keerthi)
- 原点をシンプレクスへ射影する
- 原点とシンプレクスの最短距離、方向を使用

- 原点を含むようなシンプレクスを生成することで衝突検出する
- A, B のミンコフスキー差 を C とする
    - A, B のサポートポイントを求め、その差を取ったものが C のサポートポイントとなる

#### 手順
- (ここでは(1, 1, 1)方向の) サポートポイントを選択する
- 原点に対し反対方向を探索方向とする
- ループ
    - 探索方向に新しいサポートポイントを見つける
        - 見つからない場合は、これ以上拡張できないので衝突無し、終了
        - 原点を超えて反対側でない場合は、原点を含まないので衝突無し、終了
        - サポートポイントを追加し、シンプレクスを更新
    - シンプレクス上での原点の重心パラメータと、次の探索方向を求める
        - 探索方向は、重心座標から原点へ向かうベクトル
        - 探索方向ベクトルの長さがほぼゼロなら、シンプレクスが原点を含み衝突、終了
        - 探索方向ベクトルの長さが最短を更新できない場合は終了
            - 四角形の対角線上に原点がいるような場合、2 三角形間で切り替わり続る状態を回避
    - 有効な重心パラメータとならないサポートポイントは除外する
    - 3 シンプレクス (四面体) でここまで来れば、原点を含み衝突、終了
 
### EPA
- 接触点と接触法線を求める
- 原点に最も近いミンコフスキー差 C 表面上の点が、A, B の最大貫通点となり、原点からその点に向かう方向が、接触法線となる
- シンプレクスの全面に対し原点との距離を求め、最も近い面を破棄し、その面の法線方向に拡張していく、拡張できなくなったらそれが最近接面となり、接触点を持つ
(特定の方向に凸包を作っていく感じ)
- 面上での重心座標を求め、A, B の点を再構築する
- A, B がほとんど同じ点の場合、法線が正確に止まらないので、バイアスを用いて、A, B をわずかに拡張してから計算する







